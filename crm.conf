<IfModule mod_ssl.c>
        <VirtualHost *:80>

                ServerName              domain.fr
                Redirect                / https://www.domain.fr

                RewriteEngine On
                RewriteRule ^(.*)$ https://%{HTTP_HOST}$1 [R=301,L]

        </VirtualHost>
        <VirtualHost *:443>
                ServerName              www.domain.fr
                ServerAlias             www.domain.fr
                DocumentRoot            /srv

                #SSL
                SSLCertificateFile      /etc/letsencrypt/live/www.domain.fr/cert.pem
                SSLCertificateKeyFile   /etc/letsencrypt/live/www.domain.fr/privkey.pem
                SSLCertificateChainFile /etc/letsencrypt/live/www.domain.fr/chain.pem

                SSLEngine               on
                SSLProtocol             all -SSLv3 -TLSv1 -TLSv1.1 -TLSv1.2
                SSLHonorCipherOrder     off
                SSLSessionTickets       off

                Protocols h2 http/1.1

                # HTTP Strict Transport Security (mod_headers is required) (63072000 seconds)
                Header always set Strict-Transport-Security "max-age=63072000"

                #Logs
#               ErrorLog ${APACHE_LOG_DIR}/error-django.log
#               CustomLog ${APACHE_LOG_DIR}/access-django.log combined

                #Python_WSGI
                Alias /site_media/ /srv/creme_crm-2.1/creme/media/static/

                <Directory /srv/creme_crm-2.1/creme/media/static>
                        Require all granted
                        Options -Includes -ExecCGI -FollowSymlinks
                </Directory>

                WSGIDaemonProcess www-data processes=2 threads=15 display-name=creme-app python-path=/srv/creme_crm-2.1:/home/user/.virtualenvs/creme_2_1/lib/python3.6/site-packages
                WSGIProcessGroup www-data
                WSGIApplicationGroup %{GLOBAL}
                WSGIScriptAlias / /srv/creme_crm-2.1/creme/django.wsgi

                <Directory /srv/creme_crm-2.1/creme/>
                <Files django.wsgi>
                        Require all granted
                        Options -Includes -ExecCGI -FollowSymlinks
                </Files>
                </Directory>

        </VirtualHost>
</IfModule>
